{% extends "template.html" %}

{% block content %}
<div align="center">
    主机：<select id="host" style="width: 180px; height: 26px; margin-right: 20px;">
            {% for foo in hosts %}
                <option value="{{ foo[0].split(':')[0] }}">{{ foo[0].split(':')[0] }}</option>
            {% endfor %}
    </select>
    类型: <select id="type" style="width: 180px; height: 26px; margin-right: 20px;">
        <option value="port">端口号</option>
        <option value="pid">进程号</option>
        <option value="system">系统</option>
    </select>
    端口号: <input type="text" name="port" id="port" placeholder="请输入端口号或进程号" style="margin-right: 20px;">
    开始时间: <input type="text" name="starttime" id="starttime" style="margin-right: 20px;" value="{{ starttime }}">
    结束时间: <input type="text" name="endtime" id="endtime" style="margin-right: 20px;" value="{{ endtime }}">
    <button type="button" id="MonitorList">&nbsp;画&nbsp;&nbsp;&nbsp;图&nbsp;</button>
</div>
<div id="figure"></div>
{% endblock %}

{% block myjs %}
<script type="text/javascript">
    $("#MonitorList").click(function () {
        let port = 0;
        let host = document.getElementById('host').value;
        let type = document.getElementById('type').value;
        let num = document.getElementById('port').value;
        let starttime = document.getElementById('starttime').value;
        let endtime = document.getElementById('endtime').value;
        try{
                port = parseInt(num, 10);
                if (type === 'port' || type === 'pid') {
                    if (isNaN(port) || port < 1) {
                        $.Toast('请输入端口号！', 'error');
                        return;
                    }
                }
        }
        catch (err) {
            $.Toast(err, 'error');
            return;
        }
        let post_data = {
            host: host,
            type: type,
            port: port,
            startTime: starttime,
            endTime: endtime,
        };
        $(function visualize() {
            $.ajax({
                type: 'post',
                url: 'plotMonitor',
                data: post_data,
                dataType: "html",
                success: function (data) {
                    $("#figure").html(data);
                }
            });
        })
    });
</script>
{% endblock %}
